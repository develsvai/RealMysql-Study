# 클러스터링 인덱스 

## 8.8 클러스터링 인덱스 

1. 클러스터링 이란, 여러개를 하나로 묶는 다는 의미 
2. mysql 서버 에서의 클러스터링은 테이블의 레코드를 비슷한 것(프라이머리 키 기준)들끼리 묶어서 저장하는 형태로 구성 
3. mysql 서버의 클러스터링은 innoDB에서만 지원함.


### 8.8.1 

1. 클러스터링 인덱스는 테이블의 프라이머리 키에 대해서만 적용됨
2. 클러스터링 된 테이블은 프라이머리 키 값 자체 에 대한 의존도가 높아 신중히 프라이머리 키값을 결정 해야함.
3. b-tree도 인덱스 키값으로 정렬되어 있지만 클러스터링 인덱스라 하지 않는다. 테이블 레코드 가
프라이머리 키값을 기준으로 정렬된 경우에만 클러스터링 인덱스라 함.

클러스터링 인덱스 = 클러스터링 테이블(테이블 레코드의 저장 방식)

<img width="449" alt="스크린샷 2024-03-10 오전 2 43 17" src="https://github.com/develsvai/RealMysql-Study/assets/125961256/0005c27f-5452-4348-9e31-8c824749069f">

myisam 테이블 이나 다른 스토리지 엔진의 테이블은 인덱스 키 값이 변경된다고 해서 데이터 레코드의 위치는 변경되지 않는다. 
데이터 레코드가 insert 될때 데이터 파일의 끝에 저장한다.

한번 결정된  위치는 절대 빠뀌지 않고 레코드가 저장 된 주소는 Mysql 내부적으로 레코드를 식별하는 아이디로 인식된다. 
이를 ROW_ID 라고표현 하며, mysql 에서는 이값은 노출 되지 않는다.

### 8.8.2 세컨더리 인덱스 에 미치는 영향 

세컨터리 인덱스 -> 메인 테이블의 기본키가 아닌 다른열 에 대한 인덱스

1. Myisam 이나 memory 스토리지 엔진에서는 프라이머리 키 와 세컨더리 인덱스는 구조적으로 차이가 없다.
2. innoDB는 세컨 더리 인덱스 가 실제 저장된 주소를 가지고 있다면 클러스터링 키값이 변경 될때 마다 데이터 레코드의 주소가 바뀌고 해당 테이의 모든 인덱스에 저장된 주솟값을 변경해야 하기때문에 InnoDB 의 클러스터링 테이블 의 모든 세컨더리 인덱스는 해당 레코드의 실제 주소가 아니라 프라이머리 키 값을 저장하도록 한다.

### 8.8.3 클러스터링 인덱스의 장점과 단점 

장점
1. 프라이머리 키 로 검색할때 처리 성능이 매우 빠름
2. 테이블의 모든 세컨더리 인덱스가 프라이머리 키를 가지고 있기에 인덱스 많으로 처리 될수 있는 경우가 많음(커버링 인덱스)

단점
1. 테이블의 모든 세컨더리 이덱스가 클러스터링 키를 갖기 떄문에 클러스터링 키 값의 크기가 클 경우 전체적으로 인덱스의 크기가 커짐
2. 세컨더리 인덱스를 통해 검색 할떄 프라이머리 키로 다시한번 검색해야 함으로 처리성능이 느림
3. INSERT 할때 프라이머리 키에 의해 레코드의 저장 위치가 결정되기 때문에 처리성능이 느림
4. 프라이머리 키 를 변경할때 레코드를 delete 하고 INSERT하는 작업이 필요하기에 처리성능이 느림

### 8.8.4 클러스터링 테이블 사용시 주의사항 

#### 클러스터링 인덱스 키의 크기 

<img width="597" alt="스크린샷 2024-03-10 오전 3 48 31" src="https://github.com/develsvai/RealMysql-Study/assets/125961256/4e0594ea-00c8-4162-8813-a370dd21f82c">


#### 프라이머리 키는 auto-increment 보다는 업무적인 칼럼으로 생성 
"Auto Increment"는 자동 증가하는 숫자 값으로, 주로 데이터베이스의 테이블에서 사용되는 기능입니다. 주로 테이블의 기본키(primary key)에 사용되며, 데이터베이스가 자동으로 값을 증가시켜주기 때문에 일련번호를 생성하는 데 유용합니다.

클러스터링 인덱스를 지원하지 않는 스토리지엔진에서는 키값으로 뭘 선택 해도 성능 차이는 크게 나지 않는다 .
하지만 프라이머리 키는 데이블을 대표하는 키 값 이니만큼 검색에 많이 사용된다. 칼럼의 크기가 크더라도 업무적으로 해당 레코드를 대표 할수 있다면 해당 칼럼을 프라이머리 키로 사용할것.


#### 프라이 머리 키는 반드시 명시 할것 

innoDB에서는 프라이머리 키가 없는 테이블에 관해서는 스토리지 엔진이 자동으로 일련번호를 부여 하게 되는데 이는 사용자가 접근할수 없다. 왠만하면 auto-increment 를 사용해서 라도 프라이머리 키를 생성할것,

#### auto-increment 칼럼을 인조 식별자로 사용할 경우 
여러 칼럼이 복합으로 프라이머리 키가 만들어지는 경우 프라이머리 키의 크기가 크더라도 세컨더리 인덱스가 필요치 않는다면 그대로 프라이머리 키로 사용하는 것이 좋다.

세컨더리 인덱스가 필요하다면 auto-increment 사용해서 칼럼을 추가하고 키로 설정한다. 
이를 인조 식별자라 한다. 

### 8.9 유니크 인덱스 

이는 인덱스 라기 보다 제약조건에 가까움 




