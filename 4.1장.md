## 4장 아키텍쳐 

mysql 서버는 사람의 머리역활을 담당하는 MySql 엔진과 손발을 담당하는 스토리지 엔진으로 구분할수 있다. 
그리고 손과 발의 역활을 담당하는 스토리지 엔진은 핸들러 api를 만족하면 누구든지 스토리지 엔진을 구현해서 MySql 서버에 추가해서 사용할수 있다. 
이번장에서는 MySql 엔진과 MySql 서버에서 기본으로 제공되는 InnoDB 스토리지 엔진, 그리고 MySql 스토리지 엔진을 구분해서 살펴보겠다. 

## 4.1.1 MySql 엔진 아키텍쳐 

<img width="392" alt="스크린샷 2024-02-13 오전 1 26 33" src="https://github.com/develsvai/RealMysql-Study/assets/125961256/74d31211-0506-43e5-87c8-d02423bdfe4a">

#### 1.MySql은 다른 RDBMS와 같이 대부분의 프로그래밍 언어로 부터의 접근 방법을 모두 지원한다. 
#### 2.MySql은 C API부터 JDBC,ODBC,.NET표준 드라이버 를 제공하여 이를 활용해 프로그래밍 언어를 통해 접근 가능 하다. 

### 4.1.1.1 MySql 엔진 
MySql 엔진은 클라이언트 로 부터의 접속 및 쿼리 요청 을 처리하는 커넥션 핸들러와 SQL 파서 및 전처리기, 쿼리의 최적화 된 실행을 위한 옵티마이저가 중심을 이룬다. 
MySql 은 표준 SQL문법 을 따르기에 표준 문법에 따라 작성된 쿼리는 타 DBMS와 호환되어 실행 할수 있다. 


### 4.1.1.2 스토리지 엔진 
MySql 엔진 은 요청된 SQL 문장을 분석하거나 최적화 하는 등 DBMS 의 두뇌에 해당 하는 처리를 수행한다. 
Storage 엔진은 데이터를 드라이브에 저장 또는 디스크 스토리지로 부터 데이터를 읽어오는 등의 역활을 수행한다. 

MySql 서버에서 MySql엔진은 하나이지만 스토리지 엔진은 여러 개를 동시에 사용할 수 있다 .

myslq > CREATE TABLE test_table (fd1 INT, fd2, INT) ENGINE=INNOBD;
위와 같이 지정하면 사용할 스토리지 엔진을 지정할수 있다. 

### 4.1.1.3 핸들러 API 
MySql 엔진의 쿼리 실행기 에서 데이터를 쓰거나 읽어야 할때는 각 스토리지 엔진에 쓰기 또는 읽기 를 요청하는데 이러한 요청을
핸들러(Handler) 요청이라 함.

여기서 사용되는 API를 핸들러 API 라고 함. 
InnoDB 스토리지 엔진 또한 이핸들로 API를 이용해 MySql 엔진과 데이토를 주고 받는다 .

핸들로 API를 통해 얼마나 많은 데이터(레코드) 작업이 있었는지는 

mysql > SHOW GLOBAL STATUS LIKE 'Handler%';

<img width="247" alt="스크린샷 2024-02-13 오전 2 11 05" src="https://github.com/develsvai/RealMysql-Study/assets/125961256/8b191723-9be1-448a-9ba6-de5cae7f79f5">

위의 명령어로 확인 할 수 있다. 


## 4.1.2 MySql 스레딩 구조 

MySql 서버는 프로세스 기반이 아니라 스레드 기반으로 작동하며 

포그라운드(foreground) , 백그라운드(background) 나눌수 있다.

실행중인 스레드 목록은 

<img width="571" alt="스크린샷 2024-02-13 오전 2 16 35" src="https://github.com/develsvai/RealMysql-Study/assets/125961256/d9e1a1e3-24d2-40bb-a475-6260811f8fbd">

위와같이 확인 할 수 있다.

## 4.1.2.1 포그라운드 스레드(클라이언트 스레드)

포그라운드 스레드는 최소한 MySql 서버에 접속된 클라이언트의 수만큼 존재하며, 주로 각 클라이언트 사용자가 요청하는 쿼리 문장을 처리함. 

클라이언트 사용자가 작업을 마치고 커넥션을 종료하면 해당 커넥션을 담당하던 스레드는 다시 스레트 캐시로 되돌아감.

단 스래드 캐시에 이미 일정 개수 이상의 스레드 가 존재하면 캐시에 넣지 않고 , 스레드를 종료 시키고 일정 개수의 스레드 수 를 유지함.(이는 시스템 변수로 설정가능)








